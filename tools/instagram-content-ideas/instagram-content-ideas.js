// ---------- Helpers ----------
  const $ = (id)=>document.getElementById(id);
  const toast = (msg)=>{
    const t = $('toast');
    t.textContent = msg;
    t.style.display = 'block';
    clearTimeout(window.__t);
    window.__t = setTimeout(()=>t.style.display='none', 1400);
  };
  const pick = (arr)=>arr[Math.floor(Math.random()*arr.length)];
  const shuffle = (arr)=>arr.map(v=>({v, r:Math.random()})).sort((a,b)=>a.r-b.r).map(x=>x.v);

  function toneify(tone, text){
    const tweaks = {
      friendly: {prefix:"", suffix:""},
      bold: {prefix:"๐ฅ ", suffix:""},
      pro: {prefix:"", suffix:""},
      emotional: {prefix:"โจ ", suffix:""}
    };
    const t = tweaks[tone] || tweaks.friendly;
    return (t.prefix + text + t.suffix).trim();
  }

  // ---------- Smart packs (Hooks / CTAs) ----------
  function buildHooksPack({goal, tone, niche, acct}){
    const base = {
      "ุจูุณุช": [
        "ูฃ ุฃุฎุทุงุก ุชููุนู ูู ุงููุตูู โ ุฑูู 2 ูุฏููุฑ ุงูุชูุงุนู",
        "ูุจู ูุง ุชุนูู ุณูุฑููโฆ ุงุญูุธ ูุฐุง ูุฃูู ุณูููุฏู ูุงุญููุง",
        "ูู ููุช ููุงููุ ุณุฃูุดุฑ ูุฐุง ุงูููู ๐",
        "ูุฐุง ุงูุดูุก ูุญุฏู ูุฑูุน ุงูุชูุงุนู ูู ุทุจูุชู ุตุญ"
      ],
      "ุฑููุฒ": [
        "ุฃููู ุงูุชูุฑูุฑโฆ ูุฐุง ุณูุบููุฑ ูุชูุฌุชู ุฎูุงู ุฃุณุจูุน",
        "ุงููุฑู ุจูู ุญุณุงุจ ุนุงุฏู ูุญุณุงุจ ููู ูู 10 ุซูุงู",
        "ุฌุฑูุจ ูุฐุง ุงูููู ูุดูู ุงููุฑู ุจููุณู",
        "3 ุซูุงูู ุชูููโฆ ุฎูู ูุนู"
      ],
      "ุณุชูุฑู": [
        "ุชุตููุช ุณุฑูุน: ุฃู ุฎูุงุฑ ุชุฎุชุงุฑุ",
        "ุณุคุงู ุจุฏูู ุฅุญุฑุงุฌ: ูุฐุง ูุตูุฑ ูุนูุ",
        "ุฎููููุง ููุฑุฑ ุณูุง ุจุณุฑุนุฉโฆ",
        "ุฌุงูุจูู ุจุตุฑุงุญุฉ ๐"
      ]
    };

    // ุชุฎุตูุต ููู ููููุฏููุฒ/ูุงุดู
    if(niche === "fashion" || acct === "model"){
      base["ุฑููุฒ"].unshift(
        "ูฃ ุจูุฒุงุช ุชุฎููู ุชุจุงู ุฃุบูู ููุฑูุง (ุจุฏูู ุฎุจุฑุฉ)",
        "ููุทุฉ ูุงุญุฏุฉ ุชุฑูุน ุจุฑููุงููู ูู ููุฏูู โ ุดูู ููู",
        "ุฅุฐุง ุตูุฑุชู ุชุทูุน ุนุงุฏูุฉโฆ ุฌุฑูุจ ูุฐุง ุงูุชุนุฏูู ุงูุจุณูุท"
      );
      base["ุจูุณุช"].unshift(
        "ูฅ ุจูุฒุงุช ููุตูุฑ ุงูุซุงุจุชุฉโฆ ุงุญูุธูุง ูุทุจููุง ููุฑูุง",
        "ููู ุชุจูู Portfolio ูุดุฏ ุงูุจุฑุงูุฏุงุชุ (ุฎุทูุฉ ุจุฎุทูุฉ)"
      );
      base["ุณุชูุฑู"].unshift(
        "ุงุฎุชุงุฑ: ููู 1 ููุง ููู 2ุ",
        "ููู ูุญุจ ุชุตููุฑ ุณุชูุฏูู ุฃูุซุฑุ"
      );
    }

    // ุญุณุจ ุงููุฏู
    if(goal === "sales"){
      base["ุจูุณุช"].unshift("ูุจู ูุง ุชุญุท ุงูุณุนุฑโฆ ูู ูุฐุง ุฃูููุง");
      base["ุฑููุฒ"].unshift("ูุฐู ุทุฑููุฉ ุชุฎูู ุงููุงุณ ุชุทูุจ ุจุฏูู ุฅุนูุงูุงุช");
    }
    if(goal === "followers"){
      base["ุฑููุฒ"].unshift("ูุฐุง ุงูููุน ูุฌูุจ ูุชุงุจุนูู ูุฃูู ูุงุจู ูููุดุงุฑูุฉ");
      base["ุจูุณุช"].unshift("ุฅุฐุง ุชุจุบู ูุชุงุจุนููโฆ ูุฐุง ุงููุญุชูู ูุดุชุบู ุฏุงุฆููุง");
    }
    if(goal === "engagement"){
      base["ุจูุณุช"].unshift("ูุฐุง ุงูููุดูุฑ ููุญูุธโฆ ูุง ุชุถูุน ุงูููุฑุฉ");
      base["ุฑููุฒ"].unshift("ุงูุชุจ (ุชู) ูู ุชุจุบู ุฌุฒุก 2");
    }

    // tone applied later per item
    return base;
  }

  function buildCTAPack({goal, acct, brand}){
    const name = (brand && brand.trim()) ? brand.trim() : "ุญุณุงุจู";
    const byType = {
      "ุจูุณุช": {
        engagement: [
          "ุงุญูุธู ูุงุฑุฌุน ูู + ุงูุชุจ ุฑุฃูู",
          "ุฃู ููุทุฉ ูุงูุช ุงูุฃููุ 1/2/3",
          "ุงุฑุณููุง ูุตุฏูู ูุญุชุงุฌูุง"
        ],
        followers:  [
          "ุชุงุจุน "+name+" ูููุฒูุฏ ูู ุงูุฃููุงุฑ ุงูููููุฉ",
          "ุงูุชุจ (ููุฑุฉ) ูุณุฃุฑุณู ูู ุฌุฒุก 2",
          "ุฅุฐุง ุงุณุชูุฏุชโฆ ุชุงุจุนูู"
        ],
        sales:      [
          "ุงูุชุจ (ุชูุงุตูู) ูุฃุฑุณู ูู ุงูุนุฑุถ",
          "ุฑุงุณููู ุงูุขู ูุณุฃูุชุฑุญ ุงูุฃูุณุจ",
          "ุงูุฑุงุจุท ูู ุงูุจุงูู / DM ุงูุขู"
        ]
      },
      "ุฑููุฒ": {
        engagement: [
          "ุงูุชุจ (ุชู) ูู ุชุจุบู ุฌุฒุก 2",
          "ุงุญูุธ ุงูููุฏูู ูุฌุฑูุจู ุงูููู",
          "ูู 10 ูู ุชุนุทููุ"
        ],
        followers:  [
          "ุชุงุจุน "+name+" ูุฃู ุงููุงุฏู ุฃููู",
          "ููุดู ุดุฎุต ูุญุชุงุฌ ูุฐุง",
          "ุงูุชุจ (ูุญุชูู) ูุฃุนุทูู 3 ุฃููุงุฑ ุฅุถุงููุฉ"
        ],
        sales:      [
          "ุฑุงุณููู ุจูููุฉ (ุทูุจ)",
          "ุงุญุฌุฒ ุงูุขู โ ุงูุฑุงุจุท ูู ุงูุจุงูู",
          "ุงูุชุจ (ุณุนุฑ) ูุฃุฑุณู ูู ุงูุฎูุงุฑุงุช"
        ]
      },
      "ุณุชูุฑู": {
        engagement: [
          "ุตููุช ูุฎููููุง ููุฑุฑ ุณูุง",
          "ุงูุชุจ ุฌูุงุจู ูู ุตูุฏูู ุงูุณุคุงู",
          "ุชุจุบู ูููุฐุฌ ุฌุงูุฒุ ูู ูุนู"
        ],
        followers:  [
          "ุตููุช ูุฑุงุญ ุฃูุฒู ุงูุฌุฒุก ุงููุงุฏู",
          "ุงุฑุณููุง ูุตุฏูู + ุชุงุจุน "+name,
          "ุงูุชุจ (ูุนู) ูุฃุฑุณู ุฃููุงุฑ ุฃูุซุฑ"
        ],
        sales:      [
          "ุฑุฏ ุนูู ุงูุณุชูุฑู ุจูููุฉ (ุทูุจ)",
          "ูู ุชุฑูุฏ ุงูุฃุณุนุงุฑุ ุงูุชุจ (ุณุนุฑ)",
          "ุงุญุฌุฒ ูู ุงูุฑุงุจุท"
        ]
      }
    };

    const pack = {};
    ["ุจูุณุช","ุฑููุฒ","ุณุชูุฑู"].forEach(t=>{
      pack[t] = (byType[t][goal] || byType[t].engagement);
    });

    // ููุณุฉ ููููุฏููุฒ
    if(acct === "model"){
      pack["ุจูุณุช"].unshift("ูู ุชุจุบู ูุฑุงุฌุนุฉ ุจุฑููุงููู: ุงูุชุจ (Portfolio)");
      pack["ุฑููุฒ"].unshift("ูู ุชุจุบู ุชุนุงููุงุช: ุงูุชุจ (Collab)");
    }

    return pack;
  }

  // ---------- Scripts per idea (practical) ----------
  function buildScript({typeLabel, niche, acct, goal, title}){
    // ุตูุบุฉ ุนุงูุฉ ููุชุงุฒุฉ (ุฌุงูุฒุฉ ุชุทุจูู)
    const common = [
      "1) Hook ููู (1โ2 ุซุงููุฉ/ุณุทุฑ) โ 2) ุงููุดููุฉ ุจุณุฑุนุฉ โ 3) ุงูุญู ุจุฎุทูุงุช โ 4) ูุซุงู/ูุชูุฌุฉ โ 5) CTA"
    ];

    if(typeLabel === "ุฑููุฒ"){
      if(niche==="fashion" || acct==="model"){
        return "Shot-list: 1) ููุทุฉ ูุฌู/ููู (Hook) โ 2) ุจูุฒ 1 + ูุต ูุตูุฑ โ 3) ุจูุฒ 2 โ 4) ุจูุฒ 3 โ 5) ููุทุฉ ูุฑูุจุฉ (ุชูุงุตูู) โ 6) CTA ุนูู ุงูุดุงุดุฉ";
      }
      if(goal==="sales"){
        return "Shot-list: 1) ุงููุดููุฉ (Hook) โ 2) ุงูููุชุฌ/ุงูุญู โ 3) ูุชูุฌุฉ/ูุจู-ุจุนุฏ โ 4) ุฅุซุจุงุช (ุชูููู/ุฑุณุงูุฉ) โ 5) ุนุฑุถ ุณุฑูุน โ 6) CTA (ุงุทูุจ ุงูุขู)";
      }
      return "Shot-list: 1) Hook (1โ2 ุซ) โ 2) 3 ููุงุท ุณุฑูุนุฉ โ 3) ูุซุงู โ 4) ุฎุทุฃ ุดุงุฆุน โ 5) ุงูุญู โ 6) CTA";
    }

    if(typeLabel === "ุณุชูุฑู"){
      if(niche==="ecom" || goal==="sales"){
        return "Story sequence: 1) ุณุคุงู/ูุดููุฉ โ 2) ุญู ุณุฑูุน โ 3) ุฅุซุจุงุช (ูุจู/ุจุนุฏ ุฃู ุฑุฃู ุนููู) โ 4) ุนุฑุถ/ุณุนุฑ โ 5) CTA (ุฑุฏ/ุฑุงุจุท)";
      }
      if(niche==="fashion" || acct==="model"){
        return "Story sequence: 1) ุชุตููุช ููู/ุจูุฒ โ 2) ููุงููุณ ุชุตููุฑ โ 3) ูุตูุญุฉ ุจูุฒ/ุฅุถุงุกุฉ โ 4) ุณุคุงู ุตูุฏูู โ 5) CTA (Collab/Portfolio)";
      }
      return "Story sequence: 1) ุณุคุงู/ุชุตููุช โ 2) ุฅุฌุงุจุฉ ูุตูุฑุฉ โ 3) ูุซุงู โ 4) CTA (ุฑุฏ/ุฑุณุงูุฉ)";
    }

    // ุจูุณุช
    if(goal==="followers"){
      return "Carousel: 1) ุนููุงู ุฌุฐุงุจ โ 2) ุงููุดููุฉ โ 3) ุงูุณุจุจ โ 4) ุงูุญู (3 ุฎุทูุงุช) โ 5) ูุซุงู โ 6) CTA (ุชุงุจุน/ุงุญูุธ)";
    }
    if(goal==="sales"){
      return "Post: 1) ูุดููุฉ ุงูุนููู โ 2) ุงูุญู/ุงูุฎุฏูุฉ โ 3) ุงููุชูุฌุฉ โ 4) ุฅุซุจุงุช (ุนููู/ูุจู-ุจุนุฏ) โ 5) ุงูุนุฑุถ โ 6) CTA (ุฑุงุณููู)";
    }
    if(niche==="fashion" || acct==="model"){
      return "Carousel: 1) ุนููุงู (ุจูุฒุงุช/ููู) โ 2) ุจูุฒ 1 โ 3) ุจูุฒ 2 โ 4) ุจูุฒ 3 โ 5) ูุตูุญุฉ ุฅุถุงุกุฉ โ 6) CTA (ุงุญูุธ/Collab)";
    }

    return common[0];
  }

  // ---------- Idea library ----------
  const LIB = {
    marketing: {
      posts: [
        "ูุงุฆูุฉ: 7 ุฃุฎุทุงุก ุชุณููููุฉ ุชููู ูุจูุนุงุชู ูููู ุชุชุฌูุจูุง",
        "ูุจู/ุจุนุฏ: ุชุญุณูู ุฅุนูุงู/ุจูุณุช ูุชุญููู ุงููุฑู",
        "ูุงูุจ ุฌุงูุฒ: ูููุฐุฌ CTA ูุฑูุน ุงูุชุญููู",
        "ุชูููู ุชุฑูุฏ: ููุงุฐุง ุงูุชุดุฑ ูุฐุง ุงููุญุชููุ (ุชุญููู ุณุฑูุน)",
        "ุฎุทุฉ ุฃุณุจูุน: ุฌุฏูู ูุดุฑ ูุงูุนู ูุตุงุญุจ ูุดุฑูุน ุตุบูุฑ",
        "Check-list: 10 ููุงุท ูุจู ูุดุฑ ุฃู ุฅุนูุงู",
        "Case study: ูุชูุฌุฉ ุญููููุฉ ูู ุชุนุฏูู ูุงุญุฏ",
        "ูุงุฑู: ูุญุชูู ูุฌุฐุจ ูุชุงุจุนูู vs ูุญุชูู ูุจูุน",
        "ุฃุณุฆูุฉ ุฌูููุฑู: 10 ุฃุณุฆูุฉ ูุฑุฏูุฏ ูุตูุฑุฉ",
        "Myth vs Truth: ุฎุฑุงูุงุช ุงูุชุณููู ุงูุชู ุชุคุฐูู"
      ],
      reels: [
        "3 ุฃุฎุทุงุก ุชุณููููุฉ โ ุงูุญู ูู 10 ุซูุงู",
        "ุนููุงู ุฅุนูุงู ููู vs ุถุนูู (ูุฑู ุจุณูุท)",
        "ูุจู/ุจุนุฏ ูุงุจุดู ูุฑูุน ุงูุชุญููู",
        "ูู ููุช ุฃุจุฏุฃ ูู ุงูุตูุฑ: 3 ุฎุทูุงุช",
        "ุฑุฏ ุณุฑูุน ุนูู ุณุคุงู ุดุงุฆุน",
        "ุชุฑูุฏ + ุชุทุจููู ุนูู ุงูุชุณููู"
      ],
      stories: [
        "ุชุตููุช: ุฃู ุนููุงู ูุฌุฐุจู ุฃูุซุฑุ A/B",
        "ุณุคุงู ุตูุฏูู: ูุง ุฃูุจุฑ ูุดููุฉ ุชุณููู ุนูุฏูุ",
        "Mini lesson: ููุทุฉ ูุงุญุฏุฉ + ูุซุงู",
        "Behind the scenes: ููู ุชุนูู ุนูู ุญููุฉ",
        "Quiz: ูุง ุฃูุถู CTAุ",
        "CTA: ูู ุชุฑูุฏ ูุงูุจ ูุฌุงููุ ุงูุชุจ (ูุงูุจ)"
      ]
    },

    creators: {
      posts: [
        "ูุงุฆูุฉ: 20 ููุฑุฉ ูุญุชูู (ุงุญูุธูุง)",
        "ุฃุฎุทุงุก ุดุงุฆุนุฉ ุชููุน ุงูุชุดุงุฑ ุงูุฑููุฒ",
        "ููุงูุจ Hook: 10 ุฌููู ุงูุชุชุงุญูุฉ ุฌุงูุฒุฉ",
        "ุฎุทุฉ ุชุตููุฑ: 5 ููุทุงุช ุจููุฏูู ูุงุญุฏ",
        "ููู ุชุญูู ููุฑุฉ ูุงุญุฏุฉ ุฅูู 5 ููุดูุฑุงุช",
        "Q&A: ุฃุณุฆูุฉ ูุชูุฑุฑุฉ ูุฅุฌุงุจุงุช ูุตูุฑุฉ",
        "Behind the scenes: ููู ูู ุญูุงุชู ูุตุงูุน ูุญุชูู",
        "ูุงุฑู: ูุจู/ุจุนุฏ ุชุญุณูู ุงูุฅุถุงุกุฉ ุฃู ุงูุตูุช",
        "ูุงุฆูุฉ ุฃุฏูุงุช ูุฌุงููุฉ ูุตูุงุนุฉ ุงููุญุชูู",
        "ุชุญุฏู 7 ุฃูุงู: ูุชุงุฆุฌู ุจุนุฏ ุฃุณุจูุน"
      ],
      reels: [
        "3 ุฃุฎุทุงุก ุซู ุงูุญู ุจุณุฑุนุฉ",
        "ูุจู/ุจุนุฏ ูููุชุงุฌ ุจุณูุท",
        "ุชุฑูุฏ + ููุณุฉ ุดุฎุตูุฉ",
        "ูุตุฉ ูุตูุฑุฉ: ูุดููุฉ ุซู ูุชูุฌุฉ",
        "ููุฑุฉ ูุงุญุฏุฉ โ 3 ุชุทุจููุงุช",
        "ูู ููุช ููุงูู: ูุตูุญุฉ ูุจุงุดุฑุฉ"
      ],
      stories: [
        "ุงุฎุชูุงุฑ ุงูุฌูููุฑ: ุชูุดุฑ ูุงุฐุง ุงููููุ",
        "ูุตูุญุฉ ูุงุญุฏุฉ + ุณุคุงู",
        "ููุงููุณ ุงูุชุตููุฑ",
        "ูุชุงุฆุฌ/ุฅุญุตุงุกุงุช ุงูููู",
        "ุชุตููุช ุนูู ุซูู/ููู",
        "CTA: ุฃุฑุณู ูููุฉ (ููุฑุฉ) ูุฃุนุทูู ุงูุชุฑุงุญ"
      ]
    },

    lifestyle: {
      posts: [
        "ุฑูุชูู ุตุจุงุญู/ูุณุงุฆู ูุงูุนู (ุจุฏูู ูุซุงููุฉ)",
        "ูุงุฆูุฉ ุฃุดูุงุก ุชุนููุชูุง ูุคุฎุฑูุง",
        "ูุจู/ุจุนุฏ: ุชุฑุชูุจ/ุชูุธูู/ุณุชุงูู",
        "ุฃูุถู 5 ุฃูุงูู/ุฃุดูุงุก ุฌุฑุจุชูุง",
        "ูุตุฉ ูุตูุฑุฉ + ุฏุฑุณ ูุงุญุฏ",
        "ุฃุณุฆูุฉ ุดุฎุตูุฉ ุฎูููุฉ ููุฌูููุฑ",
        "ูุงุฆูุฉ: ููุชุฌุงุช/ุฃุฏูุงุช ูููุฏุฉ",
        "ููุถูุน ุฑุฃู: ูู ุชูุงููุ",
        "ุตูุฑ + ูุงุจุดู โูููุฉโ",
        "ุชุญุฏู ุฃุณุจูุนู ูุน ุงููุชุงุจุนูู"
      ],
      reels: [
        "Day in my life (ุณุฑูุน)",
        "ุงูุชูุงูุงุช ุจุณูุทุฉ + ููุณููู",
        "3 ูุตุงุฆุญ ูู 10 ุซูุงู",
        "Before/After ุณุชุงูู/ููุงู",
        "ูููู ูููู ูุถุญู",
        "ุชุฑูุฏ + ุณุคุงู ููุฌูููุฑ"
      ],
      stories: [
        "ุชุตููุช ุนูู ูุฑุงุฑ ุจุณูุท",
        "ุณุคุงู: ููู ูุงู ููููุ",
        "ุตูุฑุฉ + ูุงุจุดู ูุตูุฑ",
        "Behind the scenes",
        "ุฑูุงุจุท/ุชูุตูุงุช",
        "CTA: ุดุงุฑู ุณุชูุฑูู ูุงุนูู ููุดู"
      ]
    },

    ecom: {
      posts: [
        "ุฃูุถู ุงุณุชุฎุฏุงูุงุช ุงูููุชุฌ (5 ุทุฑู)",
        "ูุจู/ุจุนุฏ ูุชูุฌุฉ ุงูููุชุฌ",
        "FAQ: ุฃุณุฆูุฉ ุดุงุฆุนุฉ + ุฃุฌูุจุฉ",
        "ูุงุฑู: ุงูููุชุฌ vs ุงูุจุฏูู (ุจุตุฏู)",
        "ููุงููุณ: ุงูุชุบููู/ุงูุดุญู",
        "ุฏููู ููุงุณุงุช/ุงุฎุชูุงุฑ",
        "ูุฑุงุฌุนุงุช ุนููุงุก (Screenshots)",
        "ุจุงูุฏู: ููู ุชุฎุชุงุฑ ุจุงูุฉ",
        "ุญุงูุฉ ุงุณุชุฎุฏุงู ุญููููุฉ",
        "ุนุฑุถ ุฃุณุจูุนู + ุดุฑูุท ูุงุถุญุฉ"
      ],
      reels: [
        "Unboxing ุณุฑูุน",
        "ุชุฌุฑุจุฉ ุงูููุชุฌ ูู 10 ุซูุงู",
        "3 ููุงุฆุฏ + ููุทุฉ ููู ูุงุฆุฏุฉ",
        "ูุจู/ุจุนุฏ",
        "ุฑุฏ ุนูู ุงุนุชุฑุงุถ ูุดููุฑ (ุงูุณุนุฑ/ุงูุฌูุฏุฉ)",
        "ุชุฑูุฏ + ุนุฑุถ ุงูููุชุฌ"
      ],
      stories: [
        "ุงุณุชุทูุงุน: ุฃู ููู/ููุน ุชูุถูุ",
        "ุฃุณุฆูุฉ ูุฃุฌูุจุฉ",
        "ููุงููุณ ุชุฌููุฒ ุงูุทูุจุงุช",
        "ุนุฑุถ ูุญุฏูุฏ (Timer)",
        "ูุฑุงุฌุนุฉ ุนููู",
        "CTA: ุงุทูุจ ุงูุขู โ ุงูุฑุงุจุท"
      ]
    },

    edu: {
      posts: [
        "ุชุจุณูุท ููููู ุตุนุจ ูู 5 ููุงุท",
        "ูุงุฆูุฉ ูุตุทูุญุงุช ูููุฉ ููุนุงูููุง",
        "ุฎุทุฃ ุดุงุฆุน + ุงูุชุตุญูุญ",
        "ุฎุฑูุทุฉ ุทุฑูู ููุชุนูู",
        "ุฃูุถู ูุตุงุฏุฑ ูุฌุงููุฉ",
        "ุชูุฑูู ุจุณูุท + ูุซุงู ูุญููู",
        "ุณุคุงู + ุฅุฌุงุจุฉ ููุตูุฉ",
        "ููุฎุต ูุชุงุจ/ููุฏูู",
        "ููุงุนุฏ ุฐูุจูุฉ (10 ููุงุท)",
        "ุงุฎุชุจุงุฑ ุตุบูุฑ + ุงูุฅุฌุงุจุฉ"
      ],
      reels: [
        "ุชุนุฑูู ุณุฑูุน + ูุซุงู",
        "3 ููุงุท ูู 15 ุซุงููุฉ",
        "ุชุตุญูุญ ุฎุทุฃ ููุชุดุฑ",
        "ุงุฎุชุจุงุฑ ุณุฑูุน ููุฌูููุฑ",
        "ูุนูููุฉ ุฎุงุทุฆุฉ/ุตุญูุญุฉ",
        "ุณุคุงู ุซู ุงูุฅุฌุงุจุฉ"
      ],
      stories: [
        "Quiz ูููู",
        "ุณุคุงู ุตูุฏูู",
        "ููุทุฉ ูุงุญุฏุฉ + ูุซุงู",
        "ุชูุฎูุต ุฏุฑุณ",
        "ุชุตููุช ุนูู ุงูููุถูุน ุงููุงุฏู",
        "CTA: ุงุญูุธ ุงูููุดูุฑ"
      ]
    },

    fashion: {
      posts: [
        "ุฌูุณุฉ ุชุตููุฑ: 5 ุจูุฒุงุช ุฃุณุงุณูุฉ ููููุฏููุฒ",
        "Moodboard: ุณุชุงูู ุงูุฃุณุจูุน",
        "ูุจู/ุจุนุฏ: ุชุนุฏูู ุจุณูุท ูุบูุฑ ุงูุตูุฑุฉ",
        "ูุงุฆูุฉ: ุฃุฎุทุงุก ุณุชุงูู ุดุงุฆุนุฉ",
        "How-to: ุชูุณูู ูุทุนุฉ ูุงุญุฏุฉ 3 ุทุฑู",
        "ููุงููุณ ุชุตููุฑ (ูุนุฏุงุช/ุฅุถุงุกุฉ)",
        "Portfolio tips: ููู ุชุจูู ุจุฑููุงูู ููู",
        "ุตูุฑ ุทุจูุนูุฉ vs ุงุญุชุฑุงููุฉ: ูุชู ุชุณุชุฎุฏู ูู ููุนุ",
        "ูุตุงุฆุญ ุซูุฉ ุฃูุงู ุงููุงููุฑุง",
        "ููู ุชุชูุงุตู ูุน ุจุฑุงูุฏ ุจุทุฑููุฉ ุงุญุชุฑุงููุฉุ"
      ],
      reels: [
        "3 ุจูุฒุงุช + ุทุฑููุฉ ุชูููุฐูุง ุจุณุฑุนุฉ",
        "Pose-to-pose (3 ุจูุฒุงุช)",
        "Behind the scenes ุชุตููุฑ",
        "ูุจู/ุจุนุฏ Edit",
        "ุชุฑูุฏ ุตูุช + ููู ุฌุฏูุฏ",
        "ูุตูุญุฉ ุณุฑูุนุฉ ููููุฏููุฒ"
      ],
      stories: [
        "ุชุตููุช: ุฃู ููู ุฃูุถูุ",
        "Q&A ููููุฏููุฒ",
        "ููุงููุณ ุชุตููุฑ",
        "ูุจู/ุจุนุฏ Edit",
        "ูุตูุญุฉ ููููุฉ",
        "CTA: ุงุทูุจ Portfolio Review"
      ]
    }
  };

  // ---------- UI render ----------
  function renderIdea(typeLabel, title, hook, script, cta){
    const el = document.createElement('div');
    el.className = 'idea';
    const fullText =
`${typeLabel} โ ${title}
Hook: ${hook}
ุณูุฑูุจุช: ${script}
CTA: ${cta}`;
    el.innerHTML = `
      <div class="meta">
        <span class="tag">${typeLabel}</span>
        <span class="tag">ุฌุงูุฒ ูููุดุฑ</span>
      </div>
      <h3>${title}</h3>
      <p><strong style="color:var(--text)">Hook:</strong> <span style="color:var(--muted)">${hook}</span></p>
      <p style="margin-top:8px"><strong style="color:var(--text)">ุณูุฑูุจุช ุณุฑูุน:</strong> <span style="color:var(--muted)">${script}</span></p>
      <p style="margin-top:8px"><strong style="color:var(--text)">CTA:</strong> <span style="color:var(--muted)">${cta}</span></p>
      <div class="actions">
        <button class="btn secondary" type="button" data-copytext="${encodeURIComponent(fullText)}">ูุณุฎ</button>
      </div>
    `;
    return el;
  }

  function generateAll({acct, niche, goal, tone, brand}){
    const src = LIB[niche] || LIB.marketing;

    const hooksPack = buildHooksPack({goal, tone, niche, acct});
    const ctasPack  = buildCTAPack({goal, acct, brand});

    const acctHints = {
      creator: "ููุงุณุจ ูุตูุงุน ุงููุญุชูู",
      model: "ููุงุณุจ ููููุฏููุฒ/ุงููุงุดู",
      business: "ููุงุณุจ ููุญุณุงุจุงุช ุงูุชุฌุงุฑูุฉ ูุงููุชุงุฌุฑ",
      personal: "ููุงุณุจ ููุญุณุงุจุงุช ุงูุดุฎุตูุฉ"
    };

    function mkItem(typeLabel, title){
      const hook = toneify(tone, pick(hooksPack[typeLabel] || hooksPack["ุจูุณุช"]));
      const cta  = toneify(tone, pick(ctasPack[typeLabel]  || ctasPack["ุจูุณุช"]));
      const script = toneify(tone, buildScript({typeLabel, niche, acct, goal, title}));
      return {typeLabel, title: toneify(tone, title), hook, script, cta};
    }

    const posts   = shuffle(src.posts).slice(0,10).map(t=>mkItem("ุจูุณุช", t));
    const reels   = shuffle(src.reels).slice(0,6).map(t=>mkItem("ุฑููุฒ", t));
    const stories = shuffle(src.stories).slice(0,6).map(t=>mkItem("ุณุชูุฑู", t));

    // ููุฎุต ุนุงู (ุบูุฑ ููุฑุฑ/ุบูุฑ ูุฒุนุฌ)
    const globalHook = toneify(tone, pick(hooksPack["ุฑููุฒ"]));
    const globalCTA  = toneify(tone, pick(ctasPack["ุจูุณุช"]));
    const plan = (goal==="sales")
      ? "7 ุฃูุงู: (ูุดููุฉ/ุญู) โ (ุฅุซุจุงุช) โ (FAQ) โ (ูุชุงุฆุฌ) โ (ุนุฑุถ) โ (ุงุนุชุฑุงุถุงุช) โ (CTA ููู)"
      : (goal==="followers")
      ? "7 ุฃูุงู: Reels Hook ููู ูููููุง + Carousel ูููุชูู + Story ุชุตููุช/ุณุคุงู ูููููุง"
      : "7 ุฃูุงู: Carousel ูููุฉ + Reels ุชุฑูุฏู + Story ุณุคุงู/ุชุตููุช + ุฑุฏูุฏ ุณุฑูุนุฉ ุนูู ุงูุฌูููุฑ";

    return {
      acctHint: acctHints[acct] || "",
      globalHook, globalCTA, plan,
      posts, reels, stories
    };
  }

  async function copyText(txt){
    try{
      await navigator.clipboard.writeText(txt);
      toast('ุชู ุงููุณุฎ โ');
    }catch(e){
      alert('ุชุนุฐุฑ ุงููุณุฎ ุชููุงุฆููุง. ุงูุณุฎ ุงููุต ูุฏูููุง:\n\n' + txt);
    }
  }

  let lastPayload = null;

  function fill(payload){
    $('out').style.display = 'block';
    $('summary').innerHTML = `ุชู ุชูููุฏ ูุชุงุฆุฌ <strong>ุฌุงูุฒุฉ ูููุดุฑ</strong> โ ${payload.acctHint}. (ูู ููุฑุฉ ููุง Hook ู CTA ูุณูุฑูุจุช ูุฎุชูู).`;

    $('hookText').textContent = payload.globalHook;
    $('ctaText').textContent  = payload.globalCTA;
    $('planText').textContent = payload.plan;

    const postsEl = $('posts'); postsEl.innerHTML = '';
    payload.posts.forEach(x=>{
      postsEl.appendChild(renderIdea(x.typeLabel, x.title, x.hook, x.script, x.cta));
    });

    const reelsEl = $('reels'); reelsEl.innerHTML = '';
    payload.reels.forEach(x=>{
      reelsEl.appendChild(renderIdea(x.typeLabel, x.title, x.hook, x.script, x.cta));
    });

    const storiesEl = $('stories'); storiesEl.innerHTML = '';
    payload.stories.forEach(x=>{
      storiesEl.appendChild(renderIdea(x.typeLabel, x.title, x.hook, x.script, x.cta));
    });

    lastPayload = payload;
  }

  // ---------- Events ----------
  $('ideasForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const data = {
      acct: $('acct').value,
      niche: $('niche').value,
      goal: $('goal').value,
      tone: $('tone').value,
      brand: $('brand').value || ""
    };
    fill(generateAll(data));
    window.scrollTo({top: $('out').offsetTop - 80, behavior:'smooth'});
  });

  $('shuffleBtn').addEventListener('click', ()=>{
    const data = {
      acct: $('acct').value,
      niche: $('niche').value,
      goal: $('goal').value,
      tone: $('tone').value,
      brand: $('brand').value || ""
    };
    fill(generateAll(data));
    toast('ุฃููุงุฑ ุฌุฏูุฏุฉ โจ');
  });

  $('copyAllBtn').addEventListener('click', ()=>{
    if(!lastPayload){ toast('ูููุฏ ุฃููุงุฑ ุฃูููุง ๐'); return; }

    const fmt = (arr)=>arr.map(x=>`- ${x.title}\n  Hook: ${x.hook}\n  ุณูุฑูุจุช: ${x.script}\n  CTA: ${x.cta}`).join("\n\n");

    const txt =
`ููููุฏ ุฃููุงุฑ ูุญุชูู ุฅูุณุชุบุฑุงู โ MarketAPro

Hook ุนุงู:
${lastPayload.globalHook}

CTA ุนุงู:
${lastPayload.globalCTA}

ุฎุทุฉ 7 ุฃูุงู:
${lastPayload.plan}

ุฃููุงุฑ ุจูุณุช:
${fmt(lastPayload.posts)}

ุฃููุงุฑ ุฑููุฒ:
${fmt(lastPayload.reels)}

ุฃููุงุฑ ุณุชูุฑู:
${fmt(lastPayload.stories)}
`;
    copyText(txt);
  });

  // ูุณุฎ hook/cta/plan
  document.querySelectorAll('[data-copy]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const key = btn.getAttribute('data-copy');
      if(!lastPayload){ toast('ูููุฏ ุฃููุงุฑ ุฃูููุง ๐'); return; }
      if(key==='hook') return copyText(lastPayload.globalHook);
      if(key==='cta') return copyText(lastPayload.globalCTA);
      if(key==='plan') return copyText(lastPayload.plan);
    });
  });

  // ูุณุฎ ููุฑุฉ ูุงุญุฏุฉ
  document.addEventListener('click', (e)=>{
    const t = e.target;
    if(t && t.matches('button[data-copytext]')){
      const txt = decodeURIComponent(t.getAttribute('data-copytext')||'');
      copyText(txt);
    }
  });
